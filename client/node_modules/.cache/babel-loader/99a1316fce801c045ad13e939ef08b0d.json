{"ast":null,"code":"import _asyncToGenerator from\"/Users/chritsophersarmiento/git/my-portfolio/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/chritsophersarmiento/git/my-portfolio/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/Users/chritsophersarmiento/git/my-portfolio/node_modules/@babel/runtime/regenerator/index.js\";import{useState,useEffect}from\"react\";import axios from\"axios\";import Cookies from\"universal-cookie\";var cookies=new Cookies();var isAuthed=cookies.get(\"isAuthed\");var activeUser=cookies.get(\"user\");axios.defaults.withCredentials=true;var useAuth=function useAuth(){var _useState=useState(function(){if(activeUser||isAuthed)return true;return false;}),_useState2=_slicedToArray(_useState,2),isUser=_useState2[0],setUser=_useState2[1];var checkUser=localStorage.getItem(\"user\");useEffect(function(){_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return axios.post(\"http://localhost:8080/api/auth\");case 3:_context.next=10;break;case 5:_context.prev=5;_context.t0=_context[\"catch\"](0);if(_context.t0!==null&&_context.t0!==void 0&&_context.t0.response){_context.next=10;break;}alert(\"Internal server error. Try again later.\");return _context.abrupt(\"return\",setUser(false));case 10:case\"end\":return _context.stop();}}},_callee,null,[[0,5]]);}))();},[]);var handleLogin=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(username,password){var response,name;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return axios.post(\"http://localhost:8080/api/login\",JSON.stringify({username:username,password:password}),{headers:{\"Content-Type\":\"application/json\"},withCredentials:true});case 3:response=_context2.sent;name=JSON.stringify(response.data.user);localStorage.setItem(\"user\",name);setUser(true);window.location.reload();_context2.next=13;break;case 10:_context2.prev=10;_context2.t0=_context2[\"catch\"](0);alert(\"Incorrect username or password\");case 13:case\"end\":return _context2.stop();}}},_callee2,null,[[0,10]]);}));return function handleLogin(_x,_x2){return _ref2.apply(this,arguments);};}();var handleLogout=function handleLogout(){axios.delete(\"http://localhost:8080/api/clear-cookies\");axios.get(\"http://localhost:8080/api/logout\",{headers:{\"Content-Type\":\"application/json\"},withCredential:true})// .then(() => {\n//   localStorage.clear();\n// })\n.catch(function(){console.log(\"An internal server error has occurred.\");});setUser(false);localStorage.clear();window.location.reload();};return{isUser:isUser,activeUser:activeUser,checkUser:checkUser,setUser:setUser,handleLogin:handleLogin,handleLogout:handleLogout};};export default useAuth;","map":{"version":3,"sources":["/Users/chritsophersarmiento/git/my-portfolio/src/hooks/useAuth.js"],"names":["useState","useEffect","axios","Cookies","cookies","isAuthed","get","activeUser","defaults","withCredentials","useAuth","isUser","setUser","checkUser","localStorage","getItem","post","response","alert","handleLogin","username","password","JSON","stringify","headers","name","data","user","setItem","window","location","reload","handleLogout","delete","withCredential","catch","console","log","clear"],"mappings":"yYAAA,OAASA,QAAT,CAAmBC,SAAnB,KAAoC,OAApC,CACA,MAAOC,CAAAA,KAAP,KAAkB,OAAlB,CACA,MAAOC,CAAAA,OAAP,KAAoB,kBAApB,CAEA,GAAMC,CAAAA,OAAO,CAAG,GAAID,CAAAA,OAAJ,EAAhB,CACA,GAAME,CAAAA,QAAQ,CAAGD,OAAO,CAACE,GAAR,CAAY,UAAZ,CAAjB,CACA,GAAMC,CAAAA,UAAU,CAAGH,OAAO,CAACE,GAAR,CAAY,MAAZ,CAAnB,CAEAJ,KAAK,CAACM,QAAN,CAAeC,eAAf,CAAiC,IAAjC,CAEA,GAAMC,CAAAA,OAAO,CAAG,QAAVA,CAAAA,OAAU,EAAM,CACpB,cAA0BV,QAAQ,CAAC,UAAM,CACvC,GAAIO,UAAU,EAAIF,QAAlB,CAA4B,MAAO,KAAP,CAC5B,MAAO,MAAP,CACD,CAHiC,CAAlC,wCAAOM,MAAP,eAAeC,OAAf,eAKA,GAAMC,CAAAA,SAAS,CAAGC,YAAY,CAACC,OAAb,CAAqB,MAArB,CAAlB,CACAd,SAAS,CAAC,UAAM,CACd,wDAAC,yKAESC,CAAAA,KAAK,CAACc,IAAN,CAAW,gCAAX,CAFT,oIAIQ,YAAKC,QAJb,0BAKKC,KAAK,CAAC,yCAAD,CAAL,CALL,gCAMYN,OAAO,CAAC,KAAD,CANnB,sEAAD,KAeD,CAhBQ,CAgBN,EAhBM,CAAT,CAkBA,GAAMO,CAAAA,WAAW,2FAAG,kBAAOC,QAAP,CAAiBC,QAAjB,gLAEOnB,CAAAA,KAAK,CAACc,IAAN,CACrB,iCADqB,CAErBM,IAAI,CAACC,SAAL,CAAe,CAAEH,QAAQ,CAARA,QAAF,CAAYC,QAAQ,CAARA,QAAZ,CAAf,CAFqB,CAGrB,CACEG,OAAO,CAAE,CAAE,eAAgB,kBAAlB,CADX,CAEEf,eAAe,CAAE,IAFnB,CAHqB,CAFP,QAEVQ,QAFU,gBAUZQ,IAVY,CAULH,IAAI,CAACC,SAAL,CAAeN,QAAQ,CAACS,IAAT,CAAcC,IAA7B,CAVK,CAWhBb,YAAY,CAACc,OAAb,CAAqB,MAArB,CAA6BH,IAA7B,EACAb,OAAO,CAAC,IAAD,CAAP,CACAiB,MAAM,CAACC,QAAP,CAAgBC,MAAhB,GAbgB,qFAehBb,KAAK,CAAC,gCAAD,CAAL,CAfgB,uEAAH,kBAAXC,CAAAA,WAAW,iDAAjB,CAmBA,GAAMa,CAAAA,YAAY,CAAG,QAAfA,CAAAA,YAAe,EAAM,CACzB9B,KAAK,CAAC+B,MAAN,CAAa,yCAAb,EACA/B,KAAK,CACFI,GADH,CACO,kCADP,CAC2C,CACvCkB,OAAO,CAAE,CAAE,eAAgB,kBAAlB,CAD8B,CAEvCU,cAAc,CAAE,IAFuB,CAD3C,CAKE;AACA;AACA;AAPF,CAQGC,KARH,CAQS,UAAM,CACXC,OAAO,CAACC,GAAR,CAAY,wCAAZ,EACD,CAVH,EAYAzB,OAAO,CAAC,KAAD,CAAP,CACAE,YAAY,CAACwB,KAAb,GACAT,MAAM,CAACC,QAAP,CAAgBC,MAAhB,GACD,CAjBD,CAmBA,MAAO,CACLpB,MAAM,CAANA,MADK,CAELJ,UAAU,CAAVA,UAFK,CAGLM,SAAS,CAATA,SAHK,CAILD,OAAO,CAAPA,OAJK,CAKLO,WAAW,CAAXA,WALK,CAMLa,YAAY,CAAZA,YANK,CAAP,CAQD,CAvED,CAyEA,cAAetB,CAAAA,OAAf","sourcesContent":["import { useState, useEffect } from \"react\";\nimport axios from \"axios\";\nimport Cookies from \"universal-cookie\";\n\nconst cookies = new Cookies();\nconst isAuthed = cookies.get(\"isAuthed\");\nconst activeUser = cookies.get(\"user\");\n\naxios.defaults.withCredentials = true;\n\nconst useAuth = () => {\n  const [isUser, setUser] = useState(() => {\n    if (activeUser || isAuthed) return true;\n    return false;\n  });\n\n  const checkUser = localStorage.getItem(\"user\");\n  useEffect(() => {\n    (async () => {\n      try {\n        await axios.post(\"http://localhost:8080/api/auth\");\n      } catch (err) {\n        if (!err?.response) {\n          alert(\"Internal server error. Try again later.\");\n          return setUser(false);\n        }\n        // if (checkUser || activeUser) {\n        //   handleLogout();\n        //   alert(\"Unauthorized\");\n        //   window.location.reload();\n        // }\n      }\n    })();\n  }, []);\n\n  const handleLogin = async (username, password) => {\n    try {\n      const response = await axios.post(\n        \"http://localhost:8080/api/login\",\n        JSON.stringify({ username, password }),\n        {\n          headers: { \"Content-Type\": \"application/json\" },\n          withCredentials: true,\n        }\n      );\n      let name = JSON.stringify(response.data.user);\n      localStorage.setItem(\"user\", name);\n      setUser(true);\n      window.location.reload();\n    } catch {\n      alert(\"Incorrect username or password\");\n    }\n  };\n\n  const handleLogout = () => {\n    axios.delete(\"http://localhost:8080/api/clear-cookies\");\n    axios\n      .get(\"http://localhost:8080/api/logout\", {\n        headers: { \"Content-Type\": \"application/json\" },\n        withCredential: true,\n      })\n      // .then(() => {\n      //   localStorage.clear();\n      // })\n      .catch(() => {\n        console.log(\"An internal server error has occurred.\");\n      });\n\n    setUser(false);\n    localStorage.clear();\n    window.location.reload();\n  };\n\n  return {\n    isUser,\n    activeUser,\n    checkUser,\n    setUser,\n    handleLogin,\n    handleLogout,\n  };\n};\n\nexport default useAuth;\n"]},"metadata":{},"sourceType":"module"}